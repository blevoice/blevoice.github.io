{% if page.sidebar_nav or layout.sidebar_nav %}
  {% assign nav = page.sidebar_nav | default: layout.sidebar_nav %}
  <div class="sidebar sticky">
    {% if site.author_profile %}{% include author-profile.html %}{% endif %}
    <nav class="nav__list">
      {% for item in site.data.navigation[nav] %}
        <input type="radio" 
               name="nav-radio" 
               id="nav-{{ item.title | slugify }}" 
               {% if page.url contains item.url %}checked{% endif %}>
        <label for="nav-{{ item.title | slugify }}" 
               class="nav__item {% if page.url contains item.url %}active{% endif %}">
          <a href="{{ item.url | relative_url }}">{{ item.title }}</a>
        </label>
      {% endfor %}
    </nav>
  </div>
{% endif %}

    <!-- 新增文档分类导航 -->
    {% unless page.hide_doc_nav %}
      <div class="doc-categories">
        <h3 class="doc-categories-title">文档分类</h3>
        <nav class="nav__list">
          {% for item in site.data.navigation.main %}
            {% assign collection_name = item.title | downcase | replace: ' ', '-' %}
            {% assign collection = site[collection_name] %}
            
            <details class="nav__items" {% if page.collection == collection_name %}open{% endif %}>
              <summary class="nav__subtitle">
                <a href="{{ item.url }}" class="nav__link">{{ item.title }}</a>
              </summary>
              
              {% if collection %}
                <ul class="nav__sublist">
                  {% assign sorted_docs = collection | sort: "date" | reverse %}
                  {% for doc in sorted_docs limit:5 %}
                    <li class="nav__sublist-item">
                      <a href="{{ doc.url }}" 
                         class="{% if doc.url == page.url %}active{% endif %}"
                         data-format="{% if doc.path contains '.pdf' %}pdf{% else %}md{% endif %}">
                        {{ doc.title }}
                        {% if doc.path contains '.pdf' %}
                          <span class="pdf-label">PDF</span>
                        {% endif %}
                      </a>
                    </li>
                  {% endfor %}
                  {% if sorted_docs.size > 5 %}
                    <li class="nav__sublist-more">
                      <a href="{{ item.url }}">查看更多 ({{ sorted_docs.size | minus: 5 }}+)</a>
                    </li>
                  {% endif %}
                </ul>
              {% else %}
                <p class="nav__empty">暂无文档</p>
              {% endif %}
            </details>
          {% endfor %}
        </nav>
      </div>
    {% endunless %}
  </div>
{% endif %}
