{% if page.author_profile or layout.author_profile or page.sidebar %}
  <div class="sidebar sticky">
    {% if page.author_profile or layout.author_profile %}{% include author-profile.html %}{% endif %}
    
    {% if page.sidebar %}
      <!-- 保留原有sidebar内容 -->
      {% for s in page.sidebar %}
        {% if s.image %}
          <img src="{{ s.image | relative_url }}" alt="{% if s.image_alt %}{{ s.image_alt }}{% endif %}">
        {% endif %}
        {% if s.title %}<h3>{{ s.title }}</h3>{% endif %}
        {% if s.text %}{{ s.text | markdownify }}{% endif %}
        {% if s.nav %}{% include nav_list nav=s.nav %}{% endif %}
      {% endfor %}
    {% endif %}

    <!-- 新增文档分类导航 -->
    {% unless page.hide_doc_nav %}  <!-- 添加控制开关 -->
      <div class="doc-categories">
        <h3>文档分类</h3>
        <nav class="nav__list">
          {% for item in site.data.navigation.main %}
            <details class="nav__items">
              <summary class="nav__subtitle">
                <a href="{{ item.url }}">{{ item.title }}</a>
              </summary>
              <ul>
                {% assign collection_name = item.title | downcase %}
                {% assign docs = site[collection_name] | sort: "date" | reverse %}
                {% for doc in docs limit:5 %}  <!-- 限制显示数量 -->
                  <li>
                    <a href="{{ doc.url }}" class="{% if doc.url == page.url %}active{% endif %}">
                      {{ doc.title }}
                      {% if doc.path contains '.pdf' %}<span class="pdf-label">PDF</span>{% endif %}
                    </a>
                  </li>
                {% endfor %}
                {% if docs.size > 5 %}
                  <li><a href="{{ item.url }}">查看更多...</a></li>
                {% endif %}
              </ul>
            </details>
          {% endfor %}
        </nav>
      </div>
    {% endunless %}
  </div>
{% endif %}
